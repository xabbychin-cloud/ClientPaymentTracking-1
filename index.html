<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Client Payment Tracker</title>

<style>
body { margin: 0; font-family: Arial; background: #f4f6f9 }
h1 { background: #2e7d32; color: white; padding: 15px; text-align: center; margin: 0 }
#toolbar { display: flex; gap: 8px; padding: 10px; background: #333; overflow-x: auto }
#toolbar button { background: #4CAF50; color: white; border: none; padding: 10px 14px; border-radius: 4px; cursor: pointer }
#toolbar button.active { background: gold; color: black }
.section { display: none; background: white; margin: 10px; padding: 15px; border-radius: 6px }
input, select, button, textarea { width: 100%; padding: 8px; margin-top: 6px }
table { width: 100%; border-collapse: collapse; margin-top: 10px }
th, td { border: 1px solid #ccc; padding: 6px }
th { background: #eee }
.debit-red { color: red; font-weight: bold }
.unpaid-row { background: #ffd6d6; cursor:pointer }
.autocomplete { position: relative }
.autolist { position: absolute; background: white; border: 1px solid #ccc; width: 100%; z-index: 100 }
.autolist div { padding: 6px; cursor: pointer }
.autolist div:hover { background: #eee }
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,.5) }
.modal-content { background: white; width: 95%; max-width: 900px; margin: 5% auto; padding: 15px }
#logoutBtn { background: #c62828; color: white; margin: 15px }

@media (max-width: 768px) {
table, thead, tbody, th, td, tr { display: block }
th { display: none }
tr { margin-bottom: 10px }
td { display: flex; justify-content: space-between }
}
</style>
</head>

<body>
<h1>Client Payment Tracker</h1>

<div id="authSection" class="section" style="display:block">
<input id="loginEmail" placeholder="Email">
<input id="loginPassword" type="password" placeholder="Password">
<button id="loginBtn">Login</button>
<button id="signupBtn">Sign Up</button>
</div>

<div id="appSection" style="display:none">

<div id="toolbar">
<button onclick="showSection('clients')" class="active">Clients</button>
<button onclick="showSection('charge')">Add Charge</button>
<button onclick="showSection('payment')">Add Payment</button>
<button onclick="showSection('expense')">Expenses</button>
<button onclick="openAdmin()">Admin Report</button>
</div>

<div id="clients" class="section" style="display:block">
<input id="clientSearch" placeholder="Search Client">
<select id="clientFilter">
<option value="all">All</option>
<option value="outstanding">Outstanding</option>
<option value="paid">Paid</option>
</select>
<table>
<thead><tr><th>Name</th><th>Debit</th><th>Credit</th><th>Balance</th><th>Action</th></tr></thead>
<tbody id="clientsBody"></tbody>
</table>
</div>

<div id="charge" class="section">
<div class="autocomplete">
<input id="chargeName" placeholder="Client Name">
<div id="chargeAuto" class="autolist"></div>
</div>

<select id="bookingType">
<option value="">Booking Type</option>
<option value="single">Single Day</option>
<option value="multi">Multi Day</option>
</select>

<div id="singleDay" style="display:none">
<input id="singleDate" type="date">
</div>

<div id="multiDay" style="display:none">
<input id="startDate" type="date">
<input id="endDate" type="date">
</div>

<input id="chargeAmount" type="number" placeholder="Amount">
<input id="chargeRemarks" placeholder="Remarks">
<button id="addChargeBtn">Save Charge</button>
</div>

<div id="payment" class="section">
<div class="autocomplete">
<input id="paymentSearch" placeholder="Client Name">
<div id="paymentAuto" class="autolist"></div>
</div>

<div id="paymentCalendarSingle" style="display:none">
<input id="paymentSingleDate" type="date">
</div>

<div id="paymentCalendarMulti" style="display:none">
<input id="paymentStartDate" type="date">
<input id="paymentEndDate" type="date">
</div>

<input id="paymentBalance" readonly placeholder="Balance">
<input id="paymentAmount" type="number" placeholder="Amount">
<select id="paymentType">
<option>Cash</option>
<option>Bank Transfer</option>
<option>Credit Card</option>
<option>Others</option>
</select>
<select id="paymentMode">
<option>Full</option>
<option>Partial</option>
</select>
<input id="paymentRemarks" placeholder="Remarks">
<button id="addPaymentBtn">Save Payment</button>
</div>

<div id="expense" class="section"></div>

<div id="admin" class="section">
<textarea id="adminNotes"></textarea>
<button id="saveNotesBtn">Save Note</button>
<div id="adminResult"></div>
</div>

<div id="viewModal" class="modal">
<div class="modal-content">
<button onclick="viewModal.style.display='none'">Close</button>
<h3 id="viewTitle"></h3>
<div id="viewSummary"></div>
<table>
<thead><tr><th>Date</th><th>Debit</th><th>Credit</th><th>Remarks</th></tr></thead>
<tbody id="viewBody"></tbody>
</table>
</div>
</div>

<button id="logoutBtn">Logout</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const ADMIN_CODE="1234";

const app=initializeApp({
apiKey:"AIzaSyCrtGcFZVwP6dlsc_Bljr_yN-nu6hxihVg",
authDomain:"client-payment-tracker-3572b.firebaseapp.com",
projectId:"client-payment-tracker-3572b"
});

const auth=getAuth(app);
const db=getFirestore(app);
let currentUser, clients={}, expenses=[];
const cid=n=>n.toLowerCase().replace(/\s+/g,'_');

window.showSection=id=>{
document.querySelectorAll(".section").forEach(s=>s.style.display="none");
document.getElementById(id).style.display="block";
document.querySelectorAll("#toolbar button").forEach(b=>b.classList.remove("active"));
document.querySelectorAll("#toolbar button").forEach(b=>{
if(b.getAttribute("onclick")?.includes(id)) b.classList.add("active");
});
};

window.openAdmin=()=>{
if(prompt("Enter Admin Code")===ADMIN_CODE) showSection("admin");
};

function loadClients(){
onSnapshot(collection(db,"users",currentUser.uid,"clients"),snap=>{
clients={};
snap.forEach(d=>clients[d.id]=d.data());
renderClients();
});
}

window.renderClients=()=>{
clientsBody.innerHTML="";
Object.values(clients).forEach(c=>{
const bal=(c.debit||0)-(c.credit||0);
clientsBody.innerHTML+=`
<tr>
<td>${c.name}</td>
<td>${c.debit||0}</td>
<td>${c.credit||0}</td>
<td class="${bal>0?'debit-red':''}">${bal}</td>
<td><button onclick="viewClient('${c.name}')">View</button></td>
</tr>`;
});
};

let selectedHistory=null;

window.viewClient=name=>{
const c=clients[cid(name)];
viewTitle.textContent=name;
viewSummary.textContent=`Balance: ${(c.debit||0)-(c.credit||0)}`;
viewBody.innerHTML="";
(c.history||[]).forEach(h=>{
viewBody.innerHTML+=`
<tr class="unpaid-row"
onclick="selectHistory('${name}', ${JSON.stringify(h).replace(/"/g,'&quot;')})">
<td>${new Date(h.date).toLocaleString()}</td>
<td>${h.debit||0}</td>
<td>${h.credit||0}</td>
<td>${h.remarks||""}</td>
</tr>`;
});
viewModal.style.display="block";
};

window.selectHistory=(name,h)=>{
paymentSearch.value=name;
const c=clients[cid(name)];
paymentBalance.value=(c.debit||0)-(c.credit||0);
paymentRemarks.value=`Payment for balance ${paymentBalance.value}`;
showSection("payment");
};

chargeName.oninput=()=>{
chargeAuto.innerHTML="";
Object.values(clients).map(c=>c.name)
.filter(n=>n.toLowerCase().includes(chargeName.value.toLowerCase()))
.forEach(n=>{
const d=document.createElement("div");
d.textContent=n;
d.onclick=()=>{ chargeName.value=n; chargeAuto.innerHTML=""; };
chargeAuto.appendChild(d);
});
};

bookingType.onchange=()=>{
singleDay.style.display="none";
multiDay.style.display="none";
if(bookingType.value==="single") singleDay.style.display="block";
if(bookingType.value==="multi") multiDay.style.display="block";
};

paymentSearch.oninput=()=>{
paymentAuto.innerHTML="";
Object.values(clients).map(c=>c.name)
.filter(n=>n.toLowerCase().includes(paymentSearch.value.toLowerCase()))
.forEach(n=>{
const d=document.createElement("div");
d.textContent=n;
d.onclick=()=>{
paymentSearch.value=n;
paymentAuto.innerHTML="";
const c=clients[cid(n)];
paymentBalance.value=(c.debit||0)-(c.credit||0);
paymentRemarks.value=`Payment for balance ${paymentBalance.value}`;
};
paymentAuto.appendChild(d);
});
};

onAuthStateChanged(auth,u=>{
if(u){ currentUser=u; authSection.style.display="none"; appSection.style.display="block"; loadClients(); }
else{ authSection.style.display="block"; appSection.style.display="none"; }
});

loginBtn.onclick=()=>signInWithEmailAndPassword(auth,loginEmail.value,loginPassword.value);
signupBtn.onclick=()=>createUserWithEmailAndPassword(auth,loginEmail.value,loginPassword.value);
logoutBtn.onclick=()=>signOut(auth);
</script>
</body>
</html>
