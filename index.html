<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Client Payment Tracker</title>

<style>
body{font-family:Arial;margin:0}
header{
 background:#4CAF50;color:#fff;padding:10px;
 display:flex;gap:8px;flex-wrap:wrap
}
header button{background:#fff;color:#4CAF50;border:none;padding:8px}
header input{padding:6px;flex:1;min-width:180px}

table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:8px}
th{background:#f2f2f2;color:#000}

mark{background:yellow}

.modal{
 display:none;position:fixed;inset:0;
 background:rgba(0,0,0,.4);z-index:10
}
.modal-content{
 background:#fff;
 width:90%;
 max-width:700px;
 max-height:85vh;
 overflow-y:auto;
 margin:5% auto;
 padding:20px;
 border-radius:4px
}
.close{float:right;font-size:20px;cursor:pointer}

.debit-red{color:red;font-weight:bold}
.balance-red{color:red;font-weight:bold}
.balance-green{color:green;font-weight:bold}

@media(max-width:600px){
 header{gap:6px}
}

#logoutBtn{
 margin:30px 10px;
 width:calc(100% - 20px);
 padding:12px;
 background:#f44336;
 color:white;border:none
}
</style>
</head>

<body>

<header id="toolbar" style="display:none">
  <button onclick="openCharge()">Add Charge</button>
  <button onclick="openPayment()">Add Payment</button>
  <button onclick="openExpense()">Expense</button>
  <button id="adminBtn" onclick="openReport()" style="display:none">Admin Report</button>
  <input id="searchBox" placeholder="Search client...">
</header>

<table id="clientTable" style="display:none">
<thead>
<tr><th>Client</th><th>Debit</th><th>Credit</th><th>Balance</th><th>Action</th></tr>
</thead>
<tbody></tbody>
</table>

<button id="logoutBtn" style="display:none">Logout</button>

<!-- ADD CHARGE -->
<div class="modal" id="chargeModal">
<div class="modal-content">
<span class="close" onclick="closeAll()">&times;</span>
<h3>Add Charge</h3>
<input id="cFirst" placeholder="First name">
<input id="cLast" placeholder="Last name">
<input id="cAmount" type="number" placeholder="Amount">
<label>Start Date</label>
<input id="cStart" type="date">
<label>End Date</label>
<input id="cEnd" type="date">
<input id="cRemarks" placeholder="Remarks">
<button onclick="saveCharge()">Save</button>
</div>
</div>

<!-- ADD PAYMENT -->
<div class="modal" id="paymentModal">
<div class="modal-content">
<span class="close" onclick="closeAll()">&times;</span>
<h3>Add Payment</h3>
<input id="pName" placeholder="Search client name">
<div id="payableInfo"></div>
<input id="pAmount" type="number" placeholder="Amount">
<label>Payment Date</label>
<input id="pDate" type="date">
<select id="pType">
<option>Cash</option>
<option>Bank Transfer</option>
<option>Credit Card</option>
<option>Others</option>
</select>
<select id="pMode">
<option>Full Payment</option>
<option>Partial Payment</option>
</select>
<input id="pRemarks" placeholder="Remarks">
<button onclick="savePayment()">Save</button>
</div>
</div>

<!-- VIEW RECORD -->
<div class="modal" id="viewModal">
<div class="modal-content">
<span class="close" onclick="closeAll()">&times;</span>
<h3 id="vTitle"></h3>
<p><b>Total Debit:</b> <span id="vd"></span></p>
<p><b>Total Credit:</b> <span id="vc"></span></p>
<p><b>Balance:</b> <span id="vb"></span></p>
<table>
<thead>
<tr><th>Date</th><th>Debit</th><th>Credit</th><th>Remarks</th></tr>
</thead>
<tbody id="historyBody"></tbody>
</table>
</div>
</div>

<!-- EXPENSE -->
<div class="modal" id="expenseModal">
<div class="modal-content">
<span class="close" onclick="closeAll()">&times;</span>
<h3>Add Expense</h3>
<input id="eDate" type="date">
<input id="eDesc" placeholder="Description">
<input id="eInvoice" placeholder="Invoice #">
<input id="eAmount" type="number" placeholder="Amount">
<button onclick="saveExpense()">Save</button>
</div>
</div>

<!-- ADMIN REPORT -->
<div class="modal" id="reportModal">
<div class="modal-content">
<span class="close" onclick="closeAll()">&times;</span>
<h3>Admin Report</h3>
<label>Start</label>
<input id="rStart" type="date">
<label>End</label>
<input id="rEnd" type="date">
<button onclick="generateReport()">Generate</button>
<p id="reportResult"></p>
</div>
</div>

<script type="module">
import{initializeApp}from"https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import{getAuth,onAuthStateChanged,signOut}from"https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import{getFirestore,collection,doc,getDoc,setDoc,onSnapshot,addDoc,getDocs}from"https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const ADMIN_EMAIL="your@email.com";

const app=initializeApp({
 apiKey:"AIzaSyCrtGcFZVwP6dlsc_Bljr_yN-nu6hxihVg",
 authDomain:"client-payment-tracker-3572b.firebaseapp.com",
 projectId:"client-payment-tracker-3572b"
});
const auth=getAuth(app),db=getFirestore(app);

let user,clients={},expenses=[];

onAuthStateChanged(auth,u=>{
 if(u){
  user=u;
  toolbar.style.display="flex";
  clientTable.style.display="table";
  logoutBtn.style.display="block";
  if(u.email===ADMIN_EMAIL) adminBtn.style.display="inline-block";
  loadClients();
 }
});

logoutBtn.onclick=()=>signOut(auth);

function closeAll(){
 document.querySelectorAll('.modal').forEach(m=>m.style.display='none')
}
window.openCharge=()=>chargeModal.style.display='block';
window.openPayment=()=>paymentModal.style.display='block';
window.openExpense=()=>expenseModal.style.display='block';
window.openReport=()=>reportModal.style.display='block';

function loadClients(){
 onSnapshot(collection(db,"users",user.uid,"clients"),s=>{
  clients={};
  s.forEach(d=>clients[d.id]=d.data());
  render();
 });
}

function render(){
 const tb=document.querySelector("#clientTable tbody");
 tb.innerHTML="";
 Object.entries(clients).forEach(([id,c])=>{
  const bal=c.debit-c.credit;
  tb.innerHTML+=`
  <tr>
   <td>${c.firstName} ${c.lastName}</td>
   <td class="${bal>0?'debit-red':''}">${c.debit}</td>
   <td>${c.credit}</td>
   <td class="${bal>0?'balance-red':'balance-green'}">${bal}</td>
   <td><button onclick="viewClient('${id}')">View</button></td>
  </tr>`;
 });
}

window.viewClient=id=>{
 const c=clients[id],bal=c.debit-c.credit;
 vTitle.textContent=`${c.firstName} ${c.lastName}`;
 vd.textContent=c.debit;vc.textContent=c.credit;
 vb.textContent=bal;vb.className=bal>0?'balance-red':'balance-green';
 historyBody.innerHTML=c.history.map(h=>`
 <tr>
  <td>${h.date}</td>
  <td class="${h.debit>0?'debit-red':''}">${h.debit}</td>
  <td>${h.credit}</td>
  <td>${h.remarks||''}</td>
 </tr>`).join("");
 viewModal.style.display="block";
};
</script>
</body>
</html>
